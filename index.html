<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sao Rơi - Hiệu Ứng Lửa Sát Cánh - Hoa Hồng</title>
    <style>
        body {
            margin: 0;
            background: #000;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="messageBox" style="
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.95);
    color: #000;
    font-size: 1.5rem;
    padding: 20px 30px;
    border-radius: 10px;
    display: none;
    z-index: 1000;
    text-align: center;
    max-width: 90%;
">

    <div id="closeBtn" style="
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 1.2rem;
        color: #555;
        cursor: pointer;
        font-weight: bold;
    ">×</div>

   Chào bạn Thư , đây là món quà tớ muốn làm dành tặng cho cậu . Và tớ dạo gần đây tớ có ít chuyện rối lòng .
   Đó là không biết cậu còn thích tớ hay không.Nhiều lúc tớ cảm thấy mình đang làm phiền cậu, Khoảng đầu thời gian đầu tháng 7 này khi tớ không nhắn cậu thì cậu cũng không nhắn , 
   thì tớ nghĩ là không biết là cậu còn thích tớ hay không . Nhưng đến hôm qua cậu nhắn và chúng mình có tâm sự đôi chút thì tối qua tớ có suy nghĩ đôi chút.
   Và cũng nói thật thì hiện tại tớ đang nhắn với 1 bạn. Mồm tớ cứ bảo thích bạn này nhưng tớ không biết cảm xúc tớ dành cho cậu và bạn kia như thế nào.
   Nghe tồi cậu nhẻ .Thực sự ngày hôm qua tớ đưa ra quyết định quá vội vàng . Nói xong những điều này ,cậu còn tình cảm với tớ thì có thể cho tớ thêm thời gian suy nghĩ về việc này được không.
   Tớ nợ cậu 1 cái thanh xuân học trò này.


</div>


<script>
let messageShown = false;
let allConnectedTime = null;

const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const stars = [];
const totalStars = 120;
const roseCenter = { x: canvas.width / 2, y: canvas.height / 2 };
const roseRadius = 220;

function rosePosition(i, total, radius) {
    const k = 5;  // số cánh hoa hồng (tăng lên cho rõ hơn)
    const theta = (i / total) * Math.PI * 2;
    const r = radius * Math.sin(k * theta);
    const x = roseCenter.x + r * Math.cos(theta);
    const y = roseCenter.y + r * Math.sin(theta);
    return { x, y };
}

function drawFlamingStar(x, y, spikes, outerRadius, innerRadius, color, rotation) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(rotation);

    // Vẽ viền lửa sát cánh (viền glow mỏng)
    ctx.beginPath();
    ctx.moveTo(0, -outerRadius);
    for (let i = 0; i < spikes; i++) {
        ctx.rotate(Math.PI / spikes);
        ctx.lineTo(0, -innerRadius);
        ctx.rotate(Math.PI / spikes);
        ctx.lineTo(0, -outerRadius);
    }
    ctx.closePath();
    ctx.shadowBlur = 8;
    ctx.shadowColor = color;
    ctx.strokeStyle = color;
    ctx.lineWidth = 1.5;
    ctx.stroke();
    ctx.shadowBlur = 0;

    // Vẽ ngôi sao chính giữa
    ctx.beginPath();
    ctx.moveTo(0, -outerRadius);
    for (let i = 0; i < spikes; i++) {
        ctx.rotate(Math.PI / spikes);
        ctx.lineTo(0, -innerRadius);
        ctx.rotate(Math.PI / spikes);
        ctx.lineTo(0, -outerRadius);
    }
    ctx.closePath();
    ctx.fillStyle = '#fff';
    ctx.fill();

    ctx.restore();
}

for(let i = 0; i < totalStars; i++) {
    stars.push({
        x: Math.random() * canvas.width,
        y: -Math.random() * canvas.height * 1.5,  // Bắt đầu từ trên cao

        radius: Math.random() * 2 + 2,
        
        color: `hsl(${Math.random() * 360}, 100%, 60%)`,
        speedY: Math.random() * 1.5 + 1,
        target: rosePosition(i, totalStars, roseRadius),
        connected: false,
        angle: Math.random() * Math.PI * 2,
        sway: Math.random() * 0.5 + 0.5
    });
}

function animate() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    stars.forEach(star => {
        if(!star.connected){
            star.y += star.speedY;
            star.angle += 0.02;
            star.x += Math.sin(star.angle) * star.sway;

            if(star.y > canvas.height){
                star.y = 0;
                star.x = Math.random() * canvas.width;
            }

            if(Math.random() < 0.003){
                star.connected = true;
            }

            drawFlamingStar(star.x, star.y, 5, star.radius * 3, star.radius * 1.5, star.color, star.angle);

        } else {
            star.x += (star.target.x - star.x) * 0.03;
            star.y += (star.target.y - star.y) * 0.03;
            star.angle += 0.02;

            drawFlamingStar(star.x, star.y, 5, star.radius * 3, star.radius * 1.5, star.color, star.angle);
        }
    });
// Kiểm tra nếu tất cả sao đã kết nối và hiển thị thông báo sau 3 giây
if (!messageShown) {
    const allConnected = stars.every(star => star.connected);
    if (allConnected) {
        if (allConnectedTime === null) {
            allConnectedTime = Date.now();  // Bắt đầu đếm thời gian
        } else if (Date.now() - allConnectedTime >= 3000) {  // Đủ 3 giây
            document.getElementById('messageBox').style.display = 'block';
            messageShown = true;
        }
    }
}
document.getElementById('closeBtn').onclick = function() {
    document.getElementById('messageBox').style.display = 'none';
};

    ctx.lineWidth = 0.5;
    ctx.strokeStyle = 'rgba(255, 180, 220, 0.4)';
    ctx.beginPath();
    stars.forEach((star, index) => {
        if(star.connected){
            const next = stars[(index + 1) % stars.length];
            if(next.connected){
                ctx.moveTo(star.x, star.y);
                ctx.lineTo(next.x, next.y);
            }
        }
    });
    ctx.stroke();

    requestAnimationFrame(animate);
}

animate();
</script>
</body>
</html>
